<!DOCTYPE html>

<html>
<head>
  <title>mcdonough-eats.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>mcdonough-eats.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Display an alert if the Google Maps API load has an error.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> mapAPILoadFailed = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
  alert(<span class="hljs-string">"Sorry, something went wrong when trying to reach google.com, please try again."</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>This function is called after the google maps script returns.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> mapReady = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>The McDonoughEats function acts as the ViewModel for this application.
 It also holds the model but maintains seperation of concerns using the MVVM design pattern.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">var</span> McDonoughEats = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>The array allPlaces is the observableArray that holds all of the place objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    allPlaces=ko.observableArray();</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>This is the place constructor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Place</span>(<span class="hljs-params">tel,data</span>)</span>{
      <span class="hljs-keyword">this</span>.tel=tel;
      <span class="hljs-keyword">this</span>.visible= ko.observable(<span class="hljs-literal">true</span>);
      <span class="hljs-keyword">this</span>.name= data.businesses[<span class="hljs-number">0</span>].name;
      <span class="hljs-keyword">this</span>.review_count= data.businesses[<span class="hljs-number">0</span>].review_count;
      <span class="hljs-keyword">this</span>.postal_code=data.businesses[<span class="hljs-number">0</span>].location.postal_code;
      <span class="hljs-keyword">this</span>.state_code=data.businesses[<span class="hljs-number">0</span>].location.state_code;
      <span class="hljs-keyword">this</span>.city=data.businesses[<span class="hljs-number">0</span>].location.city;
      <span class="hljs-keyword">this</span>.address=data.businesses[<span class="hljs-number">0</span>].location.address;
      <span class="hljs-keyword">this</span>.snippet_text=data.businesses[<span class="hljs-number">0</span>].snippet_text;
      <span class="hljs-keyword">this</span>.snippet_image_url=data.businesses[<span class="hljs-number">0</span>].snippet_image_url;
      <span class="hljs-keyword">this</span>.image_url=data.businesses[<span class="hljs-number">0</span>].image_url;
      <span class="hljs-keyword">this</span>.rating_img_url=data.businesses[<span class="hljs-number">0</span>].rating_img_url;
      <span class="hljs-keyword">this</span>.review_count=data.businesses[<span class="hljs-number">0</span>].review_count;
      <span class="hljs-keyword">this</span>.url=data.businesses[<span class="hljs-number">0</span>].url;
      <span class="hljs-keyword">this</span>.latitude=data.businesses[<span class="hljs-number">0</span>].location.coordinate.latitude;
      <span class="hljs-keyword">this</span>.makeViz = makeViz;
      <span class="hljs-keyword">this</span>.currentlySelected = ko.observable(<span class="hljs-literal">false</span>);
      <span class="hljs-keyword">this</span>.marker={};
      <span class="hljs-keyword">this</span>.markerBounce=markerBounce;
      <span class="hljs-keyword">this</span>.stopBounce = stopBounce;
      <span class="hljs-keyword">this</span>.setMarker = setMarker;
      <span class="hljs-keyword">this</span>.makeMarker = makeMarker;
      <span class="hljs-keyword">this</span>.clearMarker = clearMarker;
      <span class="hljs-keyword">this</span>.longitude=data.businesses[<span class="hljs-number">0</span>].location.coordinate.longitude;
      <span class="hljs-keyword">this</span>.latlng ={
        lat: <span class="hljs-keyword">this</span>.latitude,
        lng: <span class="hljs-keyword">this</span>.longitude
      };
      <span class="hljs-keyword">this</span>.contentString = <span class="hljs-string">'&lt;div id="infoWindowContainer"&gt;'</span>+
      <span class="hljs-string">'&lt;h2 class="infoWindowHeader"&gt;'</span>+<span class="hljs-keyword">this</span>.name+<span class="hljs-string">'&lt;/h2&gt;'</span>+
      <span class="hljs-string">'&lt;div class ="row" id="imageRow"&gt;'</span>+
      <span class="hljs-string">'&lt;div class = "col-md-2 col-sm-2 col-xs-5" id = "restPic"&gt;'</span>+
      <span class="hljs-string">'&lt;img src='</span>+<span class="hljs-keyword">this</span>.image_url+<span class="hljs-string">'&gt;'</span>+
      <span class="hljs-string">'&lt;/div&gt;'</span>+
      <span class="hljs-string">'&lt;div class = "col-md-2 col-sm-2 col-xs-5" id = "snippetPic"&gt;'</span>+
      <span class="hljs-string">'&lt;img class= "snippetPic" src='</span>+<span class="hljs-keyword">this</span>.snippet_image_url+<span class="hljs-string">'&gt;'</span>+
      <span class="hljs-string">'&lt;/div&gt;'</span>+
      <span class="hljs-string">'&lt;div class =  "col-lg-8 hidden-md hidden-sm hidden-xs"&gt;'</span>+
      <span class="hljs-string">'&lt;p id="introText"&gt; Click the telephone number to call this restaurant, or click the link below for more information:&lt;/p&gt;'</span>+
      <span class="hljs-string">'&lt;p class = "snippetText"&gt;'</span>+<span class="hljs-keyword">this</span>.snippet_text+<span class="hljs-string">'&lt;/p&gt;'</span>+
      <span class="hljs-string">'&lt;/div&gt;'</span>+

      <span class="hljs-string">'&lt;/div&gt;'</span>+
      <span class="hljs-string">'&lt;div class = "row" id ="addressRow"&gt;'</span>+
      <span class="hljs-string">'&lt;div class="col-lg-12 hidden-md hidden-sm hidden-xs"&gt;'</span>+
      <span class="hljs-string">'&lt;p id="addressP"&gt;&lt;b&gt; Address: '</span>+ <span class="hljs-keyword">this</span>.address+<span class="hljs-string">', '</span>+<span class="hljs-keyword">this</span>.city+<span class="hljs-string">', '</span>+<span class="hljs-keyword">this</span>.state_code+<span class="hljs-string">' '</span>+<span class="hljs-keyword">this</span>.postal_code + <span class="hljs-string">'&lt;/b&gt;&lt;/p&gt;'</span>+
      <span class="hljs-string">'&lt;/div&gt;'</span>+
      <span class="hljs-string">'&lt;/div&gt;'</span>+
      <span class="hljs-string">'&lt;div class = "row" id = "phoneRow"&gt;'</span>+
      <span class="hljs-string">'&lt;div class="col-md-12 col-sm-12 col-xs-12"&gt;'</span>+
      <span class="hljs-string">'&lt;span id="phoneP"&gt;&lt;b&gt; Phone: '</span>+<span class="hljs-string">'&lt;a href=tel:'</span>+ <span class="hljs-keyword">this</span>.tel+<span class="hljs-string">'&gt;'</span>+ <span class="hljs-string">'('</span>+<span class="hljs-keyword">this</span>.tel.slice(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>)+<span class="hljs-string">') '</span>+<span class="hljs-keyword">this</span>.tel.slice(<span class="hljs-number">3</span>,<span class="hljs-number">6</span>)+<span class="hljs-string">'-'</span>+<span class="hljs-keyword">this</span>.tel.slice(<span class="hljs-number">6</span>,<span class="hljs-number">10</span>)+<span class="hljs-string">'&lt;/a&gt;&lt;/b&gt;&lt;/span&gt;'</span>+
      <span class="hljs-string">'&lt;/div&gt;'</span>+
      <span class="hljs-string">'&lt;/div&gt;'</span>+
      <span class="hljs-string">'&lt;img src='</span>+<span class="hljs-keyword">this</span>.rating_img_url+<span class="hljs-string">'&gt;'</span>+
      <span class="hljs-keyword">this</span>.review_count+<span class="hljs-string">' reviews  '</span>+
      <span class="hljs-string">'&lt;img id='</span>+<span class="hljs-string">'"infoWinYelpImg"'</span> + <span class="hljs-string">'src='</span>+yelpImgAttrib()+<span class="hljs-string">'&gt;'</span>+

      <span class="hljs-string">'&lt;p&gt; &lt;a href='</span>+<span class="hljs-keyword">this</span>.url+<span class="hljs-string">' target="_blank"&gt;Click here to visit this page on Yelp.com'</span>+
      <span class="hljs-string">'&lt;/p&gt;&lt;/a&gt;'</span>+
      <span class="hljs-string">'&lt;/div&gt;'</span>+
      <span class="hljs-string">'&lt;/div&gt;'</span>;
      <span class="hljs-keyword">return</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p> The initialPlaces array holds local restaurant phone numbers.
 It acts as the initial data model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">var</span> initialPlaces = [

      {tel: <span class="hljs-string">'7709544306'</span>}, <span class="hljs-comment">//name: "Mikie's Big Burger"</span>
      {tel: <span class="hljs-string">'6785838777'</span>}, <span class="hljs-comment">//name: "Kirby G's"</span>
      {tel: <span class="hljs-string">'6787592690'</span>}, <span class="hljs-comment">//name: 'South Side Diner'</span>
      {tel: <span class="hljs-string">'7703209311'</span>}, <span class="hljs-comment">//name: 'Pasta Max'</span>
      {tel: <span class="hljs-string">'7709140448'</span>}, <span class="hljs-comment">//name: 'Gritz'</span>
      {tel: <span class="hljs-string">'6784322221'</span>}, <span class="hljs-comment">//name: "Truett's Grill",</span>
      {tel: <span class="hljs-string">'6788832233'</span>}  <span class="hljs-comment">//name: 'Queen Bee Coffee'</span>
    ];</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Model variables:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> map,
    yelpAttrib= ko.observable(<span class="hljs-string">'http://www.yelp.com'</span>),
    yelpImgAttrib= ko.observable(<span class="hljs-string">'https://s3-media2.fl.yelpcdn.com/assets/srv0/developer_pages/9bfe343c35cc/assets/img/yelp_powered_btn_light@2x.png'</span>),
    userInput = ko.observable(<span class="hljs-string">""</span>),
    lenInitialPlaces = initialPlaces.length,
    bound = <span class="hljs-keyword">new</span> google.maps.LatLngBounds(),
    selectedRestaurant = ko.observable(<span class="hljs-string">""</span>),
    infowindow = <span class="hljs-keyword">new</span> google.maps.InfoWindow({
      content: <span class="hljs-string">''</span>
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Initiate the google map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> initMap = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Put the map in the mapbox element and center it on the target city.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      map = <span class="hljs-keyword">new</span> google.maps.Map(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'mapBox'</span>),{
        center: {lat: <span class="hljs-number">33.4469617</span>, lng: -<span class="hljs-number">84.1419653</span>},
        scrollwheel: <span class="hljs-literal">false</span>,
        zoom: <span class="hljs-number">13</span>,
        mapTypeId: google.maps.MapTypeId.TERRAIN
      });
    }());</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Change the map boundries any time the window size changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">window</span>.onresize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      map.fitBounds(bound);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Add marker click listener.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">var</span> addMarkerListener = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>{
      google.maps.event.addListener(data.marker, <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)</span>{
        markerClicked(data.name);
      });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Instantiate markers.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> makeMarker = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-keyword">this</span>.marker = <span class="hljs-keyword">new</span> google.maps.Marker({
        position: <span class="hljs-keyword">this</span>.latlng,
        title: <span class="hljs-keyword">this</span>.name,
        map: map,
        icon: <span class="hljs-string">'http://maps.google.com/mapfiles/kml/pal2/icon36.png'</span>,
        size: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">120</span>, <span class="hljs-number">32</span>)
      });
      <span class="hljs-keyword">return</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Populates the markerArray and makes map boundries from the current marker set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> setBounds = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      markerArray=[];
      bound = <span class="hljs-keyword">new</span> google.maps.LatLngBounds();

      <span class="hljs-keyword">var</span> populateMarkerArray=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> counter3 = <span class="hljs-number">0</span>; counter3&lt;allPlaces().length;counter3++){
          <span class="hljs-keyword">if</span>(allPlaces()[counter3].visible() === <span class="hljs-literal">true</span>){
            markerArray.push(allPlaces()[counter3]);
          }
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> counter6 = <span class="hljs-number">0</span>; counter6 &lt; markerArray.length; counter6++){
          bound.extend(markerArray[counter6].marker.getPosition());
        }
      };

      populateMarkerArray();
      <span class="hljs-keyword">if</span> (markerArray.length &gt; <span class="hljs-number">1</span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Change the map zoom to the remaining locations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        map.fitBounds(bound);
      }
      <span class="hljs-keyword">if</span> (markerArray.length === <span class="hljs-number">1</span>){
        map.setZoom(<span class="hljs-number">19</span>);
        <span class="hljs-keyword">var</span> singleLocation = markerArray[<span class="hljs-number">0</span>].marker.getPosition();
        map.setCenter(singleLocation);
      }
      zoomListener = google.maps.event.addListenerOnce(map, <span class="hljs-string">'change zoom'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)</span>{
        map.setCenter(bound.getCenter());
      });
      setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        google.maps.event.removeListener(zoomListener);
      }, <span class="hljs-number">2000</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Add a click listener for each marker.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> counter4 = <span class="hljs-number">0</span>; counter4 &lt; markerArray.length; counter4++){
        addMarkerListener(markerArray[counter4]);
      }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Remove !visible markers from map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> clearMarker = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.visible() === <span class="hljs-literal">false</span> ){
        <span class="hljs-keyword">this</span>.marker.setMap(<span class="hljs-literal">null</span>);
      }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Place visible markers on map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> setMarker = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.visible() === <span class="hljs-literal">true</span> ){
        <span class="hljs-keyword">this</span>.marker.setMap(map);
      }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Function updateModel instantiates the place objects with the data returned from the ajax request to the yelp api and places them in the allPlaces array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> updateModel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tel,data</span>)</span>{
      allPlaces.push(<span class="hljs-keyword">new</span> Place(tel,data));</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Done? Make the markers.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(allPlaces().length==initialPlaces.length){
        markerInit();
      }
    };


    <span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>The yelpInfo function uses the keys needed to utilize the OAuth authentication process for the Yelp API - the keys are in the data.js file.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> yelpInfo = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Configure the oauth parameters array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      parameters = [];
      parameters.push([<span class="hljs-string">'phone'</span>, initialPlaces[i].tel]);
      parameters.push([<span class="hljs-string">'callback'</span>, <span class="hljs-string">'cb'</span>]);
      parameters.push([<span class="hljs-string">'oauth_consumer_key'</span>, auth.consumerKey]);
      parameters.push([<span class="hljs-string">'oauth_consumer_secret'</span>, auth.consumerSecret]);
      parameters.push([<span class="hljs-string">'oauth_token'</span>, auth.accessToken]);
      parameters.push([<span class="hljs-string">'oauth_signature_method'</span>, <span class="hljs-string">'HMAC-SHA1'</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Configure the getter for oauth.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> message = {
        <span class="hljs-string">'action'</span>: <span class="hljs-string">'http://api.yelp.com/v2/phone_search?'</span>,
        <span class="hljs-string">'method'</span>: <span class="hljs-string">'GET'</span>,
        <span class="hljs-string">'parameters'</span>: parameters
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Make the authentication call.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      OAuth.setTimestampAndNonce(message);
      OAuth.SignatureMethod.sign(message, accessor);
      <span class="hljs-keyword">var</span> parameterMap = OAuth.getParameterMap(message.parameters);
      parameterMap.oauth_signature = OAuth.percentEncode(parameterMap.oauth_signature);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Once authenticated, make the ajax requests for the entries in the data model.
An ajax failure returns an alert advising the user to retry.
Set an 8 second timer for ajax requests to complete.
If the timer expires, display an alert message to the user.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      <span class="hljs-keyword">var</span> yelpTimer = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        alert(<span class="hljs-string">"Sorry, something went wrong when trying to reach Yelp.com, please try again."</span>);
      },<span class="hljs-number">8000</span>);


      <span class="hljs-keyword">var</span> yelpRequest = $.ajax({
        url: message.action,
        data: parameterMap,
        cache: <span class="hljs-literal">true</span>,
        dataType: <span class="hljs-string">'jsonp'</span>,
        timeout: <span class="hljs-number">8000</span>
      });

      yelpRequest.fail(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, statusText</span>)</span>{
        alert(<span class="hljs-string">"Sorry, something went wrong when trying to reach Yelp.com, please try again."</span>);
      });

      yelpRequest.done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>{
        <span class="hljs-keyword">if</span> ( i &lt; lenInitialPlaces){
          updateModel(parameters[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>],data);
          i++;
          <span class="hljs-keyword">if</span> (i&lt;lenInitialPlaces){
            yelpInfo();
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>If the ajax request is complete, clear the timer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        clearTimeout(yelpTimer);
      });

    };  <span class="hljs-comment">//End of yelpInfo.</span>

    yelpInfo();


    <span class="hljs-keyword">var</span> markerInit = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> counter=<span class="hljs-number">0</span>;counter &lt; allPlaces().length; counter++){
        allPlaces()[counter].makeMarker();
      }
      setBounds();
      <span class="hljs-keyword">return</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>A list item was clicked. Pass the object name to markerClicked.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> placeClicked = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      markerClicked(<span class="hljs-keyword">this</span>.name);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Match the clicked item to the marker, then bounce the marker and show the infowindow.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> markerClicked = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data, event</span>)</span>{
      selectedRestaurant  = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>This is the name of the restaurant for the clicked marker.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      selectedRestaurant  = data;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Match the marker to the correct object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j=<span class="hljs-number">0</span>; j &lt; allPlaces().length; j++){
        <span class="hljs-keyword">if</span> (allPlaces()[j].name == selectedRestaurant){</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Bounce the marker.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          allPlaces()[j].markerBounce();</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Stop the marker bounce.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          allPlaces()[j].stopBounce(allPlaces()[j]);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Populate and display the infowindow.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          infowindow.setContent(allPlaces()[j].contentString);
          infowindow.open(map, allPlaces()[j].marker);</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Set the map boundaries on infowindow close.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          google.maps.event.addListener(infowindow, <span class="hljs-string">'closeclick'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            map.fitBounds(bound);
          });
        }
      }

      <span class="hljs-keyword">return</span>;
    };

    <span class="hljs-keyword">var</span> checkViz = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> counter1=<span class="hljs-number">0</span>;counter1&lt;allPlaces().length;counter1++){
        allPlaces()[counter1].makeViz();
        allPlaces()[counter1].clearMarker();
        allPlaces()[counter1].setMarker();
      }
      setBounds();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Sets the visible property based on searchbox state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> makeViz = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>If the searchbox is empty, mark all items visible.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (userInput() === <span class="hljs-string">''</span>){
        <span class="hljs-keyword">this</span>.visible(<span class="hljs-literal">true</span>);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>If something is in the search box, compare it to the names of the places.
If there is not a match, mark visible as false,
else mark true.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

      <span class="hljs-keyword">var</span> rex = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(userInput(), <span class="hljs-string">"i"</span>);
      <span class="hljs-keyword">if</span> (!rex.test(<span class="hljs-keyword">this</span>.name)){
        <span class="hljs-keyword">this</span>.visible(<span class="hljs-literal">false</span>);
      }
      <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">this</span>.visible(<span class="hljs-literal">true</span>);
      }
    };

    <span class="hljs-keyword">var</span> markerBounce = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-keyword">this</span>.marker.setAnimation(google.maps.Animation.BOUNCE);

    };</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> stopBounce= <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">elem</span>)</span>{
      setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)</span>{elem.marker.setAnimation(<span class="hljs-literal">null</span>);  }, <span class="hljs-number">1400</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Function returns:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span>{
      userInput: userInput,
      makeViz: makeViz,
      yelpAttrib: yelpAttrib,
      yelpImgAttrib: yelpImgAttrib,
      makeMarker: makeMarker,
      initMap: initMap,
      addMarkerListener:addMarkerListener,
      map: map,
      placeClicked: placeClicked,
      markerInit: markerInit,
      checkViz: checkViz,
      updateModel: allPlaces()
    };
  };
  ko.applyBindings(<span class="hljs-keyword">new</span> McDonoughEats());
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
