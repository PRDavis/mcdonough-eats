var mapReady=function(){var e=function(){function e(e,s){this.tel=e,this.visible=ko.observable("true"),this.name=s.businesses[0].name,this.review_count=s.businesses[0].review_count,this.postal_code=s.businesses[0].location.postal_code,this.state_code=s.businesses[0].location.state_code,this.city=s.businesses[0].location.city,this.address=s.businesses[0].location.address,this.snippet_text=s.businesses[0].snippet_text,this.snippet_image_url=s.businesses[0].snippet_image_url,this.image_url=s.businesses[0].image_url,this.rating_img_url=s.businesses[0].rating_img_url,this.review_count=s.businesses[0].review_count,this.url=s.businesses[0].url,this.latitude=s.businesses[0].location.coordinate.latitude,this.makeViz=y,this.currentlySelected=ko.observable("false"),this.marker={},this.markerBounce=A,this.stopBounce=M,this.setMarker=g,this.makeMarker=u,this.clearMarker=d,this.longitude=s.businesses[0].location.coordinate.longitude,this.latlng={lat:this.latitude,lng:this.longitude},this.contentString='<div id="infoWindowContainer"><h2 class="infoWindowHeader">'+this.name+'</h2><div class ="row" id="imageRow"><div class = "col-md-2 col-sm-2 col-xs-2" id = "restPic"><img src='+this.image_url+'></div><div class = "col-md-2 col-sm-2 col-xs-2" id = "snippetPic"><img class= "snippetPic" src='+this.snippet_image_url+'></div><div class =  "col-lg-8 hidden-md hidden-sm hidden-xs"><p id="introText"> Click the telephone number to call this restaurant, or click the link below for more information:</p><p class = "snippetText">'+this.snippet_text+'</p></div></div><div class = "row" id ="addressRow"><div class="col-lg-12 hidden-md hidden-sm hidden-xs"><p id="addressP"><b> Address: '+this.address+", "+this.city+", "+this.state_code+" "+this.postal_code+'</b></p></div></div><div class = "row" id = "phoneRow"><div class="col-md-12 col-sm-12 col-xs-12"><p id="phoneP"><b> Phone: <a href=tel:'+this.tel+">("+this.tel.slice(0,3)+") "+this.tel.slice(3,6)+"-"+this.tel.slice(6,10)+"</a></b></p></div></div><img src="+this.rating_img_url+">"+this.review_count+' reviews  <img id="infoWinYelpImg"src='+i()+"><p> <a href="+this.url+' target="_blank">Click here to visit this page on Yelp.com</p></a></div></div>'}allPlaces=ko.observableArray();var s,t=[{tel:"7709544306"},{tel:"6785838777"},{tel:"6787592690"},{tel:"7703209311"},{tel:"7709140448"},{tel:"6784322221"},{tel:"6788832233"}],a=ko.observable("http://www.yelp.com"),i=ko.observable("https://s3-media2.fl.yelpcdn.com/assets/srv0/developer_pages/9bfe343c35cc/assets/img/yelp_powered_btn_light@2x.png"),n=ko.observable(""),r=t.length,l=new google.maps.LatLngBounds,o=ko.observable(""),c=new google.maps.InfoWindow({content:""}),m=function(){s=new google.maps.Map(document.getElementById("mapBox"),{center:{lat:33.4469617,lng:-84.1419653},scrollwheel:!1,zoom:13,mapTypeId:google.maps.MapTypeId.TERRAIN})}(),h=function(e){google.maps.event.addListener(e.marker,"click",function(s){w(e.name)})},u=function(){this.marker=new google.maps.Marker({position:this.latlng,title:this.name,map:s,icon:"http://maps.google.com/mapfiles/kml/pal2/icon36.png",size:new google.maps.Size(120,32)})},p=function(){markerArray=[],l=new google.maps.LatLngBounds;var e=function(){for(var e=0;e<allPlaces().length;e++)"true"===allPlaces()[e].visible()&&markerArray.push(allPlaces()[e]);for(var s=0;s<markerArray.length;s++)l.extend(markerArray[s].marker.getPosition())};if(e(),markerArray.length>1&&s.fitBounds(l),1===markerArray.length){s.setZoom(19);var t=markerArray[0].marker.getPosition();s.setCenter(t)}zoomListener=google.maps.event.addListenerOnce(s,"change zoom",function(e){s.setCenter(l.getCenter())}),setTimeout(function(){google.maps.event.removeListener(zoomListener)},2e3);for(var a=0;a<markerArray.length;a++)h(markerArray[a])},d=function(){"false"===this.visible()&&this.marker.setMap(null)},g=function(){"true"===this.visible()&&this.marker.setMap(s)},v=function(s,a){allPlaces.push(new e(s,a)),allPlaces().length==t.length&&b()},k=0,f=function(){parameters=[],parameters.push(["phone",t[k].tel]),parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",auth.consumerKey]),parameters.push(["oauth_consumer_secret",auth.consumerSecret]),parameters.push(["oauth_token",auth.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var e={action:"http://api.yelp.com/v2/phone_search?",method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(e),OAuth.SignatureMethod.sign(e,accessor);var s=OAuth.getParameterMap(e.parameters);s.oauth_signature=OAuth.percentEncode(s.oauth_signature);var a=$.ajax({url:e.action,data:s,cache:!0,dataType:"jsonp",timeout:5e3});a.error(function(e,s){}),a.success(function(e){r>k&&(v(parameters[0][1],e),k++,r>k&&f())})};f();var b=function(){for(var e=0;e<allPlaces().length;e++)allPlaces()[e].makeMarker();p()},_=function(){w(this.name)},w=function(e,t){o=null,o=e;for(var a=0;a<allPlaces().length;a++)allPlaces()[a].name==o&&(allPlaces()[a].markerBounce(),allPlaces()[a].stopBounce(allPlaces()[a]),c.setContent(allPlaces()[a].contentString),c.open(s,allPlaces()[a].marker),google.maps.event.addListener(c,"closeclick",function(){s.fitBounds(l)}))},P=function(){for(var e=0;e<allPlaces().length;e++)allPlaces()[e].makeViz(),allPlaces()[e].clearMarker(),allPlaces()[e].setMarker();p()},y=function(){""===n()&&this.visible("true");var e=new RegExp($("#searchBox").val(),"i");e.test(this.name)?this.visible("true"):this.visible("false")},A=function(){this.marker.setAnimation(google.maps.Animation.BOUNCE)},M=function(e){setTimeout(function(){e.marker.setAnimation(null)},1400)};return{userInput:n,makeViz:y,yelpAttrib:a,yelpImgAttrib:i,makeMarker:u,initMap:m,addMarkerListener:h,map:s,placeClicked:_,markerInit:b,checkViz:P,updateModel:allPlaces()}};ko.applyBindings(new e)};