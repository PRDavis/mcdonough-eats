var mapAPILoadFailed=function(){},mapReady=function(){var e=function(){function e(e,t){this.tel=e,this.visible=ko.observable(!0),this.name=t.businesses[0].name,this.review_count=t.businesses[0].review_count,this.postal_code=t.businesses[0].location.postal_code,this.state_code=t.businesses[0].location.state_code,this.city=t.businesses[0].location.city,this.address=t.businesses[0].location.address,this.snippet_text=t.businesses[0].snippet_text,this.snippet_image_url=t.businesses[0].snippet_image_url,this.image_url=t.businesses[0].image_url,this.rating_img_url=t.businesses[0].rating_img_url,this.review_count=t.businesses[0].review_count,this.url=t.businesses[0].url,this.latitude=t.businesses[0].location.coordinate.latitude,this.makeViz=y,this.currentlySelected=ko.observable(!1),this.marker={},this.markerBounce=A,this.stopBounce=M,this.setMarker=g,this.makeMarker=u,this.clearMarker=d,this.longitude=t.businesses[0].location.coordinate.longitude,this.latlng={lat:this.latitude,lng:this.longitude},this.contentString='<div id="infoWindowContainer"><h2 class="infoWindowHeader">'+this.name+'</h2><div class ="row" id="imageRow"><div class = "col-md-2 col-sm-2 col-xs-5" id = "restPic"><img src='+this.image_url+'></div><div class = "col-md-2 col-sm-2 col-xs-5" id = "snippetPic"><img class= "snippetPic" src='+this.snippet_image_url+'></div><div class =  "col-lg-8 hidden-md hidden-sm hidden-xs"><p id="introText"> Click the telephone number to call this restaurant, or click the link below for more information:</p><p class = "snippetText">'+this.snippet_text+'</p></div></div><div class = "row" id ="addressRow"><div class="col-lg-12 hidden-md hidden-sm hidden-xs"><p id="addressP"><b> Address: '+this.address+", "+this.city+", "+this.state_code+" "+this.postal_code+'</b></p></div></div><div class = "row" id = "phoneRow"><div class="col-md-12 col-sm-12 col-xs-12"><span id="phoneP"><b> Phone: <a href=tel:'+this.tel+">("+this.tel.slice(0,3)+") "+this.tel.slice(3,6)+"-"+this.tel.slice(6,10)+"</a></b></span></div></div><img src="+this.rating_img_url+">"+this.review_count+' reviews  <img id="infoWinYelpImg"src='+a()+"><p> <a href="+this.url+' target="_blank">Click here to visit this page on Yelp.com</p></a></div></div>'}allPlaces=ko.observableArray();var t,s=[{tel:"7709544306"},{tel:"6785838777"},{tel:"6787592690"},{tel:"7703209311"},{tel:"7709140448"},{tel:"6784322221"},{tel:"6788832233"}],i=ko.observable("http://www.yelp.com"),a=ko.observable("https://s3-media2.fl.yelpcdn.com/assets/srv0/developer_pages/9bfe343c35cc/assets/img/yelp_powered_btn_light@2x.png"),n=ko.observable(""),o=s.length,r=new google.maps.LatLngBounds,l=ko.observable(""),c=new google.maps.InfoWindow({content:""}),m=function(){t=new google.maps.Map(document.getElementById("mapBox"),{center:{lat:33.4469617,lng:-84.1419653},scrollwheel:!1,zoom:13,mapTypeId:google.maps.MapTypeId.TERRAIN})}();window.onresize=function(){t.fitBounds(r)};var h=function(e){google.maps.event.addListener(e.marker,"click",function(t){w(e.name)})},u=function(){this.marker=new google.maps.Marker({position:this.latlng,title:this.name,map:t,icon:"http://maps.google.com/mapfiles/kml/pal2/icon36.png",size:new google.maps.Size(120,32)})},p=function(){markerArray=[],r=new google.maps.LatLngBounds;var e=function(){for(var e=0;e<allPlaces().length;e++)allPlaces()[e].visible()===!0&&markerArray.push(allPlaces()[e]);for(var t=0;t<markerArray.length;t++)r.extend(markerArray[t].marker.getPosition())};if(e(),markerArray.length>1&&t.fitBounds(r),1===markerArray.length){t.setZoom(19);var s=markerArray[0].marker.getPosition();t.setCenter(s)}zoomListener=google.maps.event.addListenerOnce(t,"change zoom",function(e){t.setCenter(r.getCenter())}),setTimeout(function(){google.maps.event.removeListener(zoomListener)},2e3);for(var i=0;i<markerArray.length;i++)h(markerArray[i])},d=function(){this.visible()===!1&&this.marker.setMap(null)},g=function(){this.visible()===!0&&this.marker.setMap(t)},v=function(t,i){allPlaces.push(new e(t,i)),allPlaces().length==s.length&&b()},k=0,f=function(){parameters=[],parameters.push(["phone",s[k].tel]),parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",auth.consumerKey]),parameters.push(["oauth_consumer_secret",auth.consumerSecret]),parameters.push(["oauth_token",auth.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var e={action:"http://api.yelp.com/v2/phone_search?",method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(e),OAuth.SignatureMethod.sign(e,accessor);var t=OAuth.getParameterMap(e.parameters);t.oauth_signature=OAuth.percentEncode(t.oauth_signature);var i=setTimeout(function(){},8e3),a=$.ajax({url:e.action,data:t,cache:!0,dataType:"jsonp",timeout:8e3});a.fail(function(e,t){}),a.done(function(e){o>k&&(v(parameters[0][1],e),k++,o>k&&f()),clearTimeout(i)})};f();var b=function(){for(var e=0;e<allPlaces().length;e++)allPlaces()[e].makeMarker();p()},_=function(){w(this.name)},w=function(e,s){l=null,l=e;for(var i=0;i<allPlaces().length;i++)allPlaces()[i].name==l&&(allPlaces()[i].markerBounce(),allPlaces()[i].stopBounce(allPlaces()[i]),c.setContent(allPlaces()[i].contentString),c.open(t,allPlaces()[i].marker),google.maps.event.addListener(c,"closeclick",function(){t.fitBounds(r)}))},P=function(){for(var e=0;e<allPlaces().length;e++)allPlaces()[e].makeViz(),allPlaces()[e].clearMarker(),allPlaces()[e].setMarker();p()},y=function(){""===n()&&this.visible(!0);var e=new RegExp(n(),"i");e.test(this.name)?this.visible(!0):this.visible(!1)},A=function(){this.marker.setAnimation(google.maps.Animation.BOUNCE)},M=function(e){setTimeout(function(){e.marker.setAnimation(null)},1400)};return{userInput:n,makeViz:y,yelpAttrib:i,yelpImgAttrib:a,makeMarker:u,initMap:m,addMarkerListener:h,map:t,placeClicked:_,markerInit:b,checkViz:P,updateModel:allPlaces()}};ko.applyBindings(new e)};